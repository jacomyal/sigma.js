import{r as xe,G as Oe,S as Ae,w as Te}from"./sigma-BsJT_GRv.js";import{r as De}from"./add-edge-DJG1E9TZ.js";import{f as we}from"./index-BUEWZHga.js";import{a as Re}from"./_commonjsHelpers-C4iS2aBk.js";import{r as ze}from"./circular-D8icM7Tl.js";import"./getters-CXJ0gpj8.js";import"./defaults-BeBqgnWC.js";var te={},_e={},be;function Ie(){return be||(be=1,_e.copyNode=function(A,M,w){return w=Object.assign({},w),A.addNode(M,w)}),_e}var ye,ke;function Le(){if(ke)return ye;ke=1;function A(M){this.graph=M,this.stack=new Array(M.order),this.seen=new Set,this.size=0}return A.prototype.hasAlreadySeenEverything=function(){return this.seen.size===this.graph.order},A.prototype.countUnseenNodes=function(){return this.graph.order-this.seen.size},A.prototype.forEachNodeYetUnseen=function(M){var w=this.seen,E=this.graph;E.someNode(function(G,J){if(w.size===E.order)return!0;if(w.has(G))return!1;var se=M(G,J);return!!se})},A.prototype.has=function(M){return this.seen.has(M)},A.prototype.push=function(M){var w=this.seen.size;return this.seen.add(M),w===this.seen.size?!1:(this.stack[this.size++]=M,!0)},A.prototype.pushWith=function(M,w){var E=this.seen.size;return this.seen.add(M),E===this.seen.size?!1:(this.stack[this.size++]=w,!0)},A.prototype.pop=function(){if(this.size!==0)return this.stack[--this.size]},ye=A,ye}var Ce;function Ne(){if(Ce)return te;Ce=1;var A=xe(),M=Ie().copyNode,w=De().copyEdge,E=Le();function G(o,m){if(!A(o))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(o.order){var p=new E(o),d=p.push.bind(p);p.forEachNodeYetUnseen(function(x){var B=[];p.push(x);for(var C;p.size!==0;)C=p.pop(),B.push(C),o.forEachNeighbor(C,d);m(B)})}}function J(o,m){if(!A(o))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(o.order){var p=new E(o),d=p.push.bind(p);p.forEachNodeYetUnseen(function(x){var B=0;p.push(x);for(var C;p.size!==0;)C=p.pop(),B++,o.forEachNeighbor(C,d);m(B)})}}function se(o,m,p){if(!A(o))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!o.order)return;var d=new E(o),x;function B(C,X,Q,N,b,e,t){x===N&&(N=Q),m(C,X,Q,N,b,e,t)&&d.push(N)}d.forEachNodeYetUnseen(function(C){var X=0;for(d.push(C);d.size!==0;)x=d.pop(),X++,o.forEachEdge(x,B);p(X)})}function oe(o){var m=0;return J(o,function(){m++}),m}function fe(o){var m=[];return G(o,function(p){m.push(p)}),m}function a(o){if(!A(o))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!o.order)return[];var m=new E(o),p=m.push.bind(m),d=[],x;return m.forEachNodeYetUnseen(function(B){x=[],m.push(B);for(var C;m.size!==0;)C=m.pop(),x.push(C),o.forEachNeighbor(C,p);return x.length>d.length&&(d=x),d.length>m.countUnseenNodes()}),d}function V(o){var m=a(o),p=o.nullCopy();return m.forEach(function(d){M(p,d,o.getNodeAttributes(d))}),o.forEachEdge(function(d,x,B,C,X,Q,N){p.hasNode(B)&&w(p,N,d,B,C,x)}),p}function ue(o){var m=new Set(a(o));o.forEachNode(function(p){m.has(p)||o.dropNode(p)})}function U(o){if(!A(o))throw new Error("graphology-components: the given graph is not a valid graphology instance.");if(!o.order)return[];if(o.type==="undirected")throw new Error("graphology-components: the given graph is undirected");var m=o.nodes(),p=[],d,x;if(!o.size){for(d=0,x=m.length;d<x;d++)p.push([m[d]]);return p}var B=1,C=[],X=[],Q=new Map,N=new Set,b,e,t,n=function(r){var i,c=o.outboundNeighbors(r),T;Q.set(r,B++),C.push(r),X.push(r);for(var W=0,Y=c.length;W<Y;W++)if(i=c[W],Q.has(i)){if(T=Q.get(i),!N.has(i))for(;Q.get(C[C.length-1])>T;)C.pop()}else n(i);if(Q.get(C[C.length-1])===Q.get(r)){b=[];do e=X.pop(),b.push(e),N.add(e);while(e!==r);p.push(b),C.pop()}};for(d=0,x=m.length;d<x;d++)t=m[d],N.has(t)||n(t);return p}return te.forEachConnectedComponent=G,te.forEachConnectedComponentOrder=J,te.forEachConnectedComponentOrderWithEdgeFilter=se,te.countConnectedComponents=oe,te.connectedComponents=fe,te.largestConnectedComponent=a,te.largestConnectedComponentSubgraph=V,te.cropToLargestConnectedComponent=ue,te.stronglyConnectedComponents=U,te}var Fe=Ne(),je=ze();const Me=Re(je);var ge={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/var qe=ge.exports,Se;function Ue(){return Se||(Se=1,function(A,M){((w,E)=>{A.exports=E()})(qe,function w(){var E=typeof self<"u"?self:typeof window<"u"?window:E!==void 0?E:{},G,J=!E.document&&!!E.postMessage,se=E.IS_PAPA_WORKER||!1,oe={},fe=0,a={};function V(e){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(t){var n=Q(t);n.chunkSize=parseInt(n.chunkSize),t.step||t.chunk||(n.chunkSize=null),this._handle=new p(n),(this._handle.streamer=this)._config=n}).call(this,e),this.parseChunk=function(t,n){var r=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<r){let c=this._config.newline;c||(i=this._config.quoteChar||'"',c=this._handle.guessLineEndings(t,i)),t=[...t.split(c).slice(r)].join(c)}this.isFirstChunk&&b(this._config.beforeFirstChunk)&&(i=this._config.beforeFirstChunk(t))!==void 0&&(t=i),this.isFirstChunk=!1,this._halted=!1;var r=this._partialLine+t,i=(this._partialLine="",this._handle.parse(r,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(t=i.meta.cursor,r=(this._finished||(this._partialLine=r.substring(t-this._baseIndex),this._baseIndex=t),i&&i.data&&(this._rowCount+=i.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),se)E.postMessage({results:i,workerId:a.WORKER_ID,finished:r});else if(b(this._config.chunk)&&!n){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=i=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!r||!b(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),r||i&&i.meta.paused||this._nextChunk(),i}this._halted=!0},this._sendError=function(t){b(this._config.error)?this._config.error(t):se&&this._config.error&&E.postMessage({workerId:a.WORKER_ID,error:t,finished:!1})}}function ue(e){var t;(e=e||{}).chunkSize||(e.chunkSize=a.RemoteChunkSize),V.call(this,e),this._nextChunk=J?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(n){this._input=n,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(t=new XMLHttpRequest,this._config.withCredentials&&(t.withCredentials=this._config.withCredentials),J||(t.onload=N(this._chunkLoaded,this),t.onerror=N(this._chunkError,this)),t.open(this._config.downloadRequestBody?"POST":"GET",this._input,!J),this._config.downloadRequestHeaders){var n,r=this._config.downloadRequestHeaders;for(n in r)t.setRequestHeader(n,r[n])}var i;this._config.chunkSize&&(i=this._start+this._config.chunkSize-1,t.setRequestHeader("Range","bytes="+this._start+"-"+i));try{t.send(this._config.downloadRequestBody)}catch(c){this._chunkError(c.message)}J&&t.status===0&&this._chunkError()}},this._chunkLoaded=function(){t.readyState===4&&(t.status<200||400<=t.status?this._chunkError():(this._start+=this._config.chunkSize||t.responseText.length,this._finished=!this._config.chunkSize||this._start>=(n=>(n=n.getResponseHeader("Content-Range"))!==null?parseInt(n.substring(n.lastIndexOf("/")+1)):-1)(t),this.parseChunk(t.responseText)))},this._chunkError=function(n){n=t.statusText||n,this._sendError(new Error(n))}}function U(e){(e=e||{}).chunkSize||(e.chunkSize=a.LocalChunkSize),V.call(this,e);var t,n,r=typeof FileReader<"u";this.stream=function(i){this._input=i,n=i.slice||i.webkitSlice||i.mozSlice,r?((t=new FileReader).onload=N(this._chunkLoaded,this),t.onerror=N(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var i=this._input,c=(this._config.chunkSize&&(c=Math.min(this._start+this._config.chunkSize,this._input.size),i=n.call(i,this._start,c)),t.readAsText(i,this._config.encoding));r||this._chunkLoaded({target:{result:c}})},this._chunkLoaded=function(i){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(i.target.result)},this._chunkError=function(){this._sendError(t.error)}}function o(e){var t;V.call(this,e=e||{}),this.stream=function(n){return t=n,this._nextChunk()},this._nextChunk=function(){var n,r;if(!this._finished)return n=this._config.chunkSize,t=n?(r=t.substring(0,n),t.substring(n)):(r=t,""),this._finished=!t,this.parseChunk(r)}}function m(e){V.call(this,e=e||{});var t=[],n=!0,r=!1;this.pause=function(){V.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){V.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(i){this._input=i,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){r&&t.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),t.length?this.parseChunk(t.shift()):n=!0},this._streamData=N(function(i){try{t.push(typeof i=="string"?i:i.toString(this._config.encoding)),n&&(n=!1,this._checkIsFinished(),this.parseChunk(t.shift()))}catch(c){this._streamError(c)}},this),this._streamError=N(function(i){this._streamCleanUp(),this._sendError(i)},this),this._streamEnd=N(function(){this._streamCleanUp(),r=!0,this._streamData("")},this),this._streamCleanUp=N(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function p(e){var t,n,r,i,c=Math.pow(2,53),T=-c,W=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,Y=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,g=this,D=0,u=0,H=!1,f=!1,_=[],s={data:[],errors:[],meta:{}};function F(y){return e.skipEmptyLines==="greedy"?y.join("").trim()==="":y.length===1&&y[0].length===0}function L(){if(s&&r&&(Z("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+a.DefaultDelimiter+"'"),r=!1),e.skipEmptyLines&&(s.data=s.data.filter(function(h){return!F(h)})),P()){let h=function(I,j){b(e.transformHeader)&&(I=e.transformHeader(I,j)),_.push(I)};if(s)if(Array.isArray(s.data[0])){for(var y=0;P()&&y<s.data.length;y++)s.data[y].forEach(h);s.data.splice(0,1)}else s.data.forEach(h)}function k(h,I){for(var j=e.header?{}:[],S=0;S<h.length;S++){var R=S,v=h[S],v=((ee,l)=>(O=>(e.dynamicTypingFunction&&e.dynamicTyping[O]===void 0&&(e.dynamicTyping[O]=e.dynamicTypingFunction(O)),(e.dynamicTyping[O]||e.dynamicTyping)===!0))(ee)?l==="true"||l==="TRUE"||l!=="false"&&l!=="FALSE"&&((O=>{if(W.test(O)&&(O=parseFloat(O),T<O&&O<c))return 1})(l)?parseFloat(l):Y.test(l)?new Date(l):l===""?null:l):l)(R=e.header?S>=_.length?"__parsed_extra":_[S]:R,v=e.transform?e.transform(v,R):v);R==="__parsed_extra"?(j[R]=j[R]||[],j[R].push(v)):j[R]=v}return e.header&&(S>_.length?Z("FieldMismatch","TooManyFields","Too many fields: expected "+_.length+" fields but parsed "+S,u+I):S<_.length&&Z("FieldMismatch","TooFewFields","Too few fields: expected "+_.length+" fields but parsed "+S,u+I)),j}var z;s&&(e.header||e.dynamicTyping||e.transform)&&(z=1,!s.data.length||Array.isArray(s.data[0])?(s.data=s.data.map(k),z=s.data.length):s.data=k(s.data,0),e.header&&s.meta&&(s.meta.fields=_),u+=z)}function P(){return e.header&&_.length===0}function Z(y,k,z,h){y={type:y,code:k,message:z},h!==void 0&&(y.row=h),s.errors.push(y)}b(e.step)&&(i=e.step,e.step=function(y){s=y,P()?L():(L(),s.data.length!==0&&(D+=y.data.length,e.preview&&D>e.preview?n.abort():(s.data=s.data[0],i(s,g))))}),this.parse=function(y,k,z){var h=e.quoteChar||'"',h=(e.newline||(e.newline=this.guessLineEndings(y,h)),r=!1,e.delimiter?b(e.delimiter)&&(e.delimiter=e.delimiter(y),s.meta.delimiter=e.delimiter):((h=((I,j,S,R,v)=>{var ee,l,O,he;v=v||[",","	","|",";",a.RECORD_SEP,a.UNIT_SEP];for(var de=0;de<v.length;de++){for(var ne,le=v[de],K=0,re=0,q=0,$=(O=void 0,new x({comments:R,delimiter:le,newline:j,preview:10}).parse(I)),ae=0;ae<$.data.length;ae++)S&&F($.data[ae])?q++:(ne=$.data[ae].length,re+=ne,O===void 0?O=ne:0<ne&&(K+=Math.abs(ne-O),O=ne));0<$.data.length&&(re/=$.data.length-q),(l===void 0||K<=l)&&(he===void 0||he<re)&&1.99<re&&(l=K,ee=le,he=re)}return{successful:!!(e.delimiter=ee),bestDelimiter:ee}})(y,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess)).successful?e.delimiter=h.bestDelimiter:(r=!0,e.delimiter=a.DefaultDelimiter),s.meta.delimiter=e.delimiter),Q(e));return e.preview&&e.header&&h.preview++,t=y,n=new x(h),s=n.parse(t,k,z),L(),H?{meta:{paused:!0}}:s||{meta:{paused:!1}}},this.paused=function(){return H},this.pause=function(){H=!0,n.abort(),t=b(e.chunk)?"":t.substring(n.getCharIndex())},this.resume=function(){g.streamer._halted?(H=!1,g.streamer.parseChunk(t,!0)):setTimeout(g.resume,3)},this.aborted=function(){return f},this.abort=function(){f=!0,n.abort(),s.meta.aborted=!0,b(e.complete)&&e.complete(s),t=""},this.guessLineEndings=function(I,h){I=I.substring(0,1048576);var h=new RegExp(d(h)+"([^]*?)"+d(h),"gm"),z=(I=I.replace(h,"")).split("\r"),h=I.split(`
`),I=1<h.length&&h[0].length<z[0].length;if(z.length===1||I)return`
`;for(var j=0,S=0;S<z.length;S++)z[S][0]===`
`&&j++;return j>=z.length/2?`\r
`:"\r"}}function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function x(e){var t=(e=e||{}).delimiter,n=e.newline,r=e.comments,i=e.step,c=e.preview,T=e.fastMode,W=null,Y=!1,g=e.quoteChar==null?'"':e.quoteChar,D=g;if(e.escapeChar!==void 0&&(D=e.escapeChar),(typeof t!="string"||-1<a.BAD_DELIMITERS.indexOf(t))&&(t=","),r===t)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||-1<a.BAD_DELIMITERS.indexOf(r))&&(r=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var u=0,H=!1;this.parse=function(f,_,s){if(typeof f!="string")throw new Error("Input must be a string");var F=f.length,L=t.length,P=n.length,Z=r.length,y=b(i),k=[],z=[],h=[],I=u=0;if(!f)return K();if(T||T!==!1&&f.indexOf(g)===-1){for(var j=f.split(n),S=0;S<j.length;S++){if(h=j[S],u+=h.length,S!==j.length-1)u+=n.length;else if(s)return K();if(!r||h.substring(0,Z)!==r){if(y){if(k=[],he(h.split(t)),re(),H)return K()}else he(h.split(t));if(c&&c<=S)return k=k.slice(0,c),K(!0)}}return K()}for(var R=f.indexOf(t,u),v=f.indexOf(n,u),ee=new RegExp(d(D)+d(g),"g"),l=f.indexOf(g,u);;)if(f[u]===g)for(l=u,u++;;){if((l=f.indexOf(g,l+1))===-1)return s||z.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:k.length,index:u}),ne();if(l===F-1)return ne(f.substring(u,l).replace(ee,g));if(g===D&&f[l+1]===D)l++;else if(g===D||l===0||f[l-1]!==D){R!==-1&&R<l+1&&(R=f.indexOf(t,l+1));var O=de((v=v!==-1&&v<l+1?f.indexOf(n,l+1):v)===-1?R:Math.min(R,v));if(f.substr(l+1+O,L)===t){h.push(f.substring(u,l).replace(ee,g)),f[u=l+1+O+L]!==g&&(l=f.indexOf(g,u)),R=f.indexOf(t,u),v=f.indexOf(n,u);break}if(O=de(v),f.substring(l+1+O,l+1+O+P)===n){if(h.push(f.substring(u,l).replace(ee,g)),le(l+1+O+P),R=f.indexOf(t,u),l=f.indexOf(g,u),y&&(re(),H))return K();if(c&&k.length>=c)return K(!0);break}z.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:k.length,index:u}),l++}}else if(r&&h.length===0&&f.substring(u,u+Z)===r){if(v===-1)return K();u=v+P,v=f.indexOf(n,u),R=f.indexOf(t,u)}else if(R!==-1&&(R<v||v===-1))h.push(f.substring(u,R)),u=R+L,R=f.indexOf(t,u);else{if(v===-1)break;if(h.push(f.substring(u,v)),le(v+P),y&&(re(),H))return K();if(c&&k.length>=c)return K(!0)}return ne();function he(q){k.push(q),I=u}function de(q){var $=0;return $=q!==-1&&(q=f.substring(l+1,q))&&q.trim()===""?q.length:$}function ne(q){return s||(q===void 0&&(q=f.substring(u)),h.push(q),u=F,he(h),y&&re()),K()}function le(q){u=q,he(h),h=[],v=f.indexOf(n,u)}function K(q){if(e.header&&!_&&k.length&&!Y){var $=k[0],ae={},me=new Set($);let ve=!1;for(let ce=0;ce<$.length;ce++){let ie=$[ce];if(ae[ie=b(e.transformHeader)?e.transformHeader(ie,ce):ie]){let pe,Ee=ae[ie];for(;pe=ie+"_"+Ee,Ee++,me.has(pe););me.add(pe),$[ce]=pe,ae[ie]++,ve=!0,(W=W===null?{}:W)[pe]=ie}else ae[ie]=1,$[ce]=ie;me.add(ie)}ve&&console.warn("Duplicate headers found and renamed."),Y=!0}return{data:k,errors:z,meta:{delimiter:t,linebreak:n,aborted:H,truncated:!!q,cursor:I+(_||0),renamedHeaders:W}}}function re(){i(K()),k=[],z=[]}},this.abort=function(){H=!0},this.getCharIndex=function(){return u}}function B(e){var t=e.data,n=oe[t.workerId],r=!1;if(t.error)n.userError(t.error,t.file);else if(t.results&&t.results.data){var i={abort:function(){r=!0,C(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:X,resume:X};if(b(n.userStep)){for(var c=0;c<t.results.data.length&&(n.userStep({data:t.results.data[c],errors:t.results.errors,meta:t.results.meta},i),!r);c++);delete t.results}else b(n.userChunk)&&(n.userChunk(t.results,i,t.file),delete t.results)}t.finished&&!r&&C(t.workerId,t.results)}function C(e,t){var n=oe[e];b(n.userComplete)&&n.userComplete(t),n.terminate(),delete oe[e]}function X(){throw new Error("Not implemented.")}function Q(e){if(typeof e!="object"||e===null)return e;var t,n=Array.isArray(e)?[]:{};for(t in e)n[t]=Q(e[t]);return n}function N(e,t){return function(){e.apply(t,arguments)}}function b(e){return typeof e=="function"}return a.parse=function(e,t){var n=(t=t||{}).dynamicTyping||!1;if(b(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!b(t.transform)&&t.transform,!t.worker||!a.WORKERS_SUPPORTED)return n=null,a.NODE_STREAM_INPUT,typeof e=="string"?(e=(r=>r.charCodeAt(0)!==65279?r:r.slice(1))(e),n=new(t.download?ue:o)(t)):e.readable===!0&&b(e.read)&&b(e.on)?n=new m(t):(E.File&&e instanceof File||e instanceof Object)&&(n=new U(t)),n.stream(e);(n=(()=>{var r;return!!a.WORKERS_SUPPORTED&&(r=(()=>{var i=E.URL||E.webkitURL||null,c=w.toString();return a.BLOB_URL||(a.BLOB_URL=i.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",c,")();"],{type:"text/javascript"})))})(),(r=new E.Worker(r)).onmessage=B,r.id=fe++,oe[r.id]=r)})()).userStep=t.step,n.userChunk=t.chunk,n.userComplete=t.complete,n.userError=t.error,t.step=b(t.step),t.chunk=b(t.chunk),t.complete=b(t.complete),t.error=b(t.error),delete t.worker,n.postMessage({input:e,config:t,workerId:n.id})},a.unparse=function(e,t){var n=!1,r=!0,i=",",c=`\r
`,T='"',W=T+T,Y=!1,g=null,D=!1,u=((()=>{if(typeof t=="object"){if(typeof t.delimiter!="string"||a.BAD_DELIMITERS.filter(function(_){return t.delimiter.indexOf(_)!==-1}).length||(i=t.delimiter),typeof t.quotes!="boolean"&&typeof t.quotes!="function"&&!Array.isArray(t.quotes)||(n=t.quotes),typeof t.skipEmptyLines!="boolean"&&typeof t.skipEmptyLines!="string"||(Y=t.skipEmptyLines),typeof t.newline=="string"&&(c=t.newline),typeof t.quoteChar=="string"&&(T=t.quoteChar),typeof t.header=="boolean"&&(r=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");g=t.columns}t.escapeChar!==void 0&&(W=t.escapeChar+T),t.escapeFormulae instanceof RegExp?D=t.escapeFormulae:typeof t.escapeFormulae=="boolean"&&t.escapeFormulae&&(D=/^[=+\-@\t\r].*$/)}})(),new RegExp(d(T),"g"));if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return H(null,e,Y);if(typeof e[0]=="object")return H(g||Object.keys(e[0]),e,Y)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields||g),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:typeof e.data[0]=="object"?Object.keys(e.data[0]):[]),Array.isArray(e.data[0])||typeof e.data[0]=="object"||(e.data=[e.data])),H(e.fields||[],e.data||[],Y);throw new Error("Unable to serialize unrecognized input");function H(_,s,F){var L="",P=(typeof _=="string"&&(_=JSON.parse(_)),typeof s=="string"&&(s=JSON.parse(s)),Array.isArray(_)&&0<_.length),Z=!Array.isArray(s[0]);if(P&&r){for(var y=0;y<_.length;y++)0<y&&(L+=i),L+=f(_[y],y);0<s.length&&(L+=c)}for(var k=0;k<s.length;k++){var z=(P?_:s[k]).length,h=!1,I=P?Object.keys(s[k]).length===0:s[k].length===0;if(F&&!P&&(h=F==="greedy"?s[k].join("").trim()==="":s[k].length===1&&s[k][0].length===0),F==="greedy"&&P){for(var j=[],S=0;S<z;S++){var R=Z?_[S]:S;j.push(s[k][R])}h=j.join("").trim()===""}if(!h){for(var v=0;v<z;v++){0<v&&!I&&(L+=i);var ee=P&&Z?_[v]:v;L+=f(s[k][ee],v)}k<s.length-1&&(!F||0<z&&!I)&&(L+=c)}}return L}function f(_,s){var F,L;return _==null?"":_.constructor===Date?JSON.stringify(_).slice(1,25):(L=!1,D&&typeof _=="string"&&D.test(_)&&(_="'"+_,L=!0),F=_.toString().replace(u,W),(L=L||n===!0||typeof n=="function"&&n(_,s)||Array.isArray(n)&&n[s]||((P,Z)=>{for(var y=0;y<Z.length;y++)if(-1<P.indexOf(Z[y]))return!0;return!1})(F,a.BAD_DELIMITERS)||-1<F.indexOf(i)||F.charAt(0)===" "||F.charAt(F.length-1)===" ")?T+F+T:F)}},a.RECORD_SEP="",a.UNIT_SEP="",a.BYTE_ORDER_MARK="\uFEFF",a.BAD_DELIMITERS=["\r",`
`,'"',a.BYTE_ORDER_MARK],a.WORKERS_SUPPORTED=!J&&!!E.Worker,a.NODE_STREAM_INPUT=1,a.LocalChunkSize=10485760,a.RemoteChunkSize=5242880,a.DefaultDelimiter=",",a.Parser=x,a.ParserHandle=p,a.NetworkStreamer=ue,a.FileStreamer=U,a.StringStreamer=o,a.ReadableStreamStreamer=m,E.jQuery&&((G=E.jQuery).fn.parse=function(e){var t=e.config||{},n=[];return this.each(function(c){if(!(G(this).prop("tagName").toUpperCase()==="INPUT"&&G(this).attr("type").toLowerCase()==="file"&&E.FileReader)||!this.files||this.files.length===0)return!0;for(var T=0;T<this.files.length;T++)n.push({file:this.files[T],inputElem:this,instanceConfig:G.extend({},t)})}),r(),this;function r(){if(n.length===0)b(e.complete)&&e.complete();else{var c,T,W,Y,g=n[0];if(b(e.before)){var D=e.before(g.file,g.inputElem);if(typeof D=="object"){if(D.action==="abort")return c="AbortError",T=g.file,W=g.inputElem,Y=D.reason,void(b(e.error)&&e.error({name:c},T,W,Y));if(D.action==="skip")return void i();typeof D.config=="object"&&(g.instanceConfig=G.extend(g.instanceConfig,D.config))}else if(D==="skip")return void i()}var u=g.instanceConfig.complete;g.instanceConfig.complete=function(H){b(u)&&u(H,g.file,g.inputElem),i()},a.parse(g.file,g.instanceConfig)}}function i(){n.splice(0,1),r()}}),se&&(E.onmessage=function(e){e=e.data,a.WORKER_ID===void 0&&e&&(a.WORKER_ID=e.workerId),typeof e.input=="string"?E.postMessage({workerId:a.WORKER_ID,results:a.parse(e.input,e.config),finished:!0}):(E.File&&e.input instanceof File||e.input instanceof Object)&&(e=a.parse(e.input,e.config))&&E.postMessage({workerId:a.WORKER_ID,results:e,finished:!0})}),(ue.prototype=Object.create(V.prototype)).constructor=ue,(U.prototype=Object.create(V.prototype)).constructor=U,(o.prototype=Object.create(o.prototype)).constructor=o,(m.prototype=Object.create(V.prototype)).constructor=m,a})}(ge)),ge.exports}var Pe=Ue();const Be=Re(Pe),We=()=>{let A=null;return Be.parse("./data.csv",{download:!0,header:!0,delimiter:",",complete:M=>{const w=new Oe;M.data.forEach(U=>{const o=U.name,m=U.acronym;w.addNode(o,{nodeType:"institution",label:[m,o].filter(d=>!!d).join(" - ")}),(U.subject_terms.match(/(?:\* )[^\n\r]*/g)||[]).map(d=>d.replace(/^\* /,"")).forEach(d=>{w.hasNode(d)||w.addNode(d,{nodeType:"subject",label:d}),w.addEdge(o,d,{weight:1})})}),Fe.cropToLargestConnectedComponent(w);const E={institution:"#FA5A3D",subject:"#5A75DB"};w.forEachNode((U,o)=>w.setNodeAttribute(U,"color",E[o.nodeType]));const G=w.nodes().map(U=>w.degree(U)),J=Math.min(...G),se=Math.max(...G),oe=2,fe=15;w.forEachNode(U=>{const o=w.degree(U);w.setNodeAttribute(U,"size",oe+(o-J)/(se-J)*(fe-oe))}),Me.assign(w);const a=we.inferSettings(w);we.assign(w,{settings:a,iterations:600});const V=document.getElementById("loader");V.style.display="none";const ue=document.getElementById("sigma-container");A=new Ae(w,ue)}}),()=>{A&&A.kill()}},He=`<style>
  html,
  body,
  #storybook-root,
  #sigma-container {
    width: 100%;
    height: 100%;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden;
  }
  #loader {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4em;
  }
</style>
<div id="sigma-container"></div>
<div id="loader"><span>⌛</span></div>
`,Ke=`/**
 * This example shows how to use graphology and sigma to interpret a dataset and
 * to transform it to a mappable graph dataset, without going through any other
 * intermediate step.
 *
 * To do this, we start from a dataset from "The Cartography of Political
 * Science in France" extracted from:
 * https://cartosciencepolitique.sciencespo.fr/#/en
 *
 * The CSV contains one line per institution, with an interesting subject_terms
 * column. We will here transform this dataset to a institution/subject
 * bipartite network map.
 */
import Graph from "graphology";
import { cropToLargestConnectedComponent } from "graphology-components";
import forceAtlas2 from "graphology-layout-forceatlas2";
import circular from "graphology-layout/circular";
import Papa from "papaparse";
import Sigma from "sigma";

export default () => {
  let renderer: Sigma | null = null;

  // 1. Load CSV file:
  Papa.parse<{ name: string; acronym: string; subject_terms: string }>("./data.csv", {
    download: true,
    header: true,
    delimiter: ",",
    complete: (results) => {
      const graph: Graph = new Graph();

      // 2. Build the bipartite graph:
      results.data.forEach((line) => {
        const institution = line.name;
        const acronym = line.acronym;

        // Create the institution node:
        graph.addNode(institution, {
          nodeType: "institution",
          label: [acronym, institution].filter((s) => !!s).join(" - "),
        });

        // Extract subjects list:
        const subjects = (line.subject_terms.match(/(?:\\* )[^\\n\\r]*/g) || []).map((str) => str.replace(/^\\* /, ""));

        // For each subject, create the node if it does not exist yet:
        subjects.forEach((subject) => {
          if (!graph.hasNode(subject)) graph.addNode(subject, { nodeType: "subject", label: subject });

          graph.addEdge(institution, subject, { weight: 1 });
        });
      });

      // 3. Only keep the main connected component:
      cropToLargestConnectedComponent(graph);

      // 4. Add colors to the nodes, based on node types:
      const COLORS: Record<string, string> = { institution: "#FA5A3D", subject: "#5A75DB" };
      graph.forEachNode((node, attributes) =>
        graph.setNodeAttribute(node, "color", COLORS[attributes.nodeType as string]),
      );

      // 5. Use degrees for node sizes:
      const degrees = graph.nodes().map((node) => graph.degree(node));
      const minDegree = Math.min(...degrees);
      const maxDegree = Math.max(...degrees);
      const minSize = 2,
        maxSize = 15;
      graph.forEachNode((node) => {
        const degree = graph.degree(node);
        graph.setNodeAttribute(
          node,
          "size",
          minSize + ((degree - minDegree) / (maxDegree - minDegree)) * (maxSize - minSize),
        );
      });

      // 6. Position nodes on a circle, then run Force Atlas 2 for a while to get
      //    proper graph layout:
      circular.assign(graph);
      const settings = forceAtlas2.inferSettings(graph);
      forceAtlas2.assign(graph, { settings, iterations: 600 });

      // 7. Hide the loader from the DOM:
      const loader = document.getElementById("loader") as HTMLElement;
      loader.style.display = "none";

      // 8. Finally, draw the graph using sigma:
      const container = document.getElementById("sigma-container") as HTMLElement;
      renderer = new Sigma(graph, container);
    },
  });

  return () => {
    if (renderer) renderer.kill();
  };
};
`,Xe={id:"csv-to-network-map",title:"Core library/Features showcases"},et={name:"From CSV to network maps",render:()=>He,play:Te(We),args:{},parameters:{storySource:{source:Ke}}};export{Xe as default,et as story};
